<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School Time Table App</title>
    <style>
        body {
            display: flex;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .left {
            background-color: #e0f7fa;
        }
        .right {
            background-color: #fff3e0;
        }
        .divider {
            width: 10px;
            background-color: #ccc;
            cursor: ew-resize;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .divider::before {
            content: '⋮⋮';
            color: #666;
            font-size: 20px;
            transform: rotate(90deg);
        }
        .value-display {
            font-size: 24px;
            margin-top: 20px;
        }
        #masterTable {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        #masterTable th, #masterTable td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        #masterTable thead {
            position: sticky;
            top: 0;
            background: white;
            z-index: 1;
        }
        .editable-cell {
            width: 100%;
            box-sizing: border-box;
            border: none;
            padding: 0;
            margin: 0;
            outline: none;
        }
        .editable-cell:focus {
            border: 1px solid blue; /* Highlight focused cell */
        }
    </style>
</head>
<body>
    <div class="panel left" id="left-panel">
        <h1>Master Time Table </h1>
        <div style="margin-bottom: 10px;">
            <button id="saveBtn">Save</button>
            <button id="loadBtn">Load</button>
        </div>
        <div id="tableContainer" style="height: 400px; overflow-y: auto;">
        <table id="masterTable">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Mon</th>
                    <th>Tue</th>
                    <th>Wed</th>
                    <th>Thu</th>
                    <th>Fri</th>
                    <th>Sat</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows will be generated dynamically -->
            </tbody>
        </table>
        </div>
    </div>
    <div class="divider" id="divider"></div>
    <div class="panel right" id="right-panel">
        <div style="margin-bottom: 10px;">
            <input type="text" id="editBox" placeholder="Enter something">
            <button id="generateBtn">Generate</button>
        </div>
        <h1>Class/Teacher Time Table</h1>
        <div id="indiTableContainer" style="height: 400px; overflow-y: auto;">
        <table id="indi-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Mon</th>
                    <th>Tue</th>
                    <th>Wed</th>
                    <th>Thu</th>
                    <th>Fri</th>
                    <th>Sat</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows will be generated dynamically -->
            </tbody>
        </table>
        </div>
    </div>

    <script>
        const table = document.getElementById('masterTable');
        const tbody = table.querySelector('tbody');
        for (let i = 0; i < 100; i++) {
            const tr = document.createElement('tr');
            for (let j = 0; j < 7; j++) {
                const td = document.createElement('td');
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'editable-cell';
                input.value = '';
                td.appendChild(input);
                tr.appendChild(td);
            }
            tbody.appendChild(tr);
        }
        const indiTable = document.getElementById('indi-table');
        const indiTbody = indiTable.querySelector('tbody');
        for (let i = 0; i < 25; i++) {
            const tr = document.createElement('tr');
            for (let j = 0; j < 7; j++) {
                const td = document.createElement('td');
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'editable-cell';
                input.value = '';
                td.appendChild(input);
                tr.appendChild(td);
            }
            indiTbody.appendChild(tr);
        }
        // Collect all editable cells from both tables
        let allEditableCells = Array.from(document.querySelectorAll('.editable-cell'));
        // Add input listeners to all cells
        allEditableCells.forEach(cell => {
            cell.addEventListener('input', () => {
                cell.value = cell.value.toUpperCase();
                cell.setAttribute('value', cell.value);
            });
        });

        // Get the edit box
        const editBox = document.getElementById('editBox');

        // Add focus listeners to master table cells
        const masterCells = Array.from(document.querySelectorAll('#masterTable .editable-cell'));
        masterCells.forEach(cell => {
            cell.addEventListener('focus', () => {
                const row = cell.closest('tr');
                const cellIndex = Array.from(row.children).indexOf(cell.closest('td'));
                if (cellIndex === 0) {
                    // Time column, display content as is
                    editBox.value = cell.value;
                } else if (cellIndex >= 1 && cellIndex <= 6) {
                    // Mon-Sat columns, check format SUB(TR)
                    const regex = /^[A-Z]{3}\([A-Z]{2}\)$/;
                    if (regex.test(cell.value)) {
                        const match = cell.value.match(/^\w+\(([^)]+)\)$/);
                        if (match) {
                            editBox.value = match[1];
                        }
                    }
                    // If not in format, do nothing (leave editBox unchanged)
                }
            });
        });
        // Define keydown handler function
        function handleKeydown(event) {
            const focusedCell = document.activeElement;
            if (!focusedCell || !focusedCell.classList.contains('editable-cell')) {
                return; // Not an editable cell, do nothing
            }
            const currentIndex = allEditableCells.indexOf(focusedCell);
            let nextIndex = -1;
            switch (event.key) {
                case 'ArrowUp':
                    // Move up a row
                    nextIndex = currentIndex - 7; // There are 7 columns
                    break;
                case 'ArrowDown':
                    // Move down a row
                    nextIndex = currentIndex + 7; // There are 7 columns
                    break;
                case 'ArrowLeft':
                    // Move left
                    if (currentIndex % 7 === 0) {
                        // Leftmost cell, wrap to rightmost in same row
                        nextIndex = currentIndex + 6;
                    } else {
                        nextIndex = currentIndex - 1;
                    }
                    break;
                case 'ArrowRight':
                    // Move right
                    if ((currentIndex + 1) % 7 === 0) {
                        // Rightmost cell, wrap to leftmost in same row
                        nextIndex = currentIndex - 6;
                    } else {
                        nextIndex = currentIndex + 1;
                    }
                    break;
                default:
                    return; // Not an arrow key, do nothing
            }
            if (nextIndex >= 0 && nextIndex < allEditableCells.length) {
                allEditableCells[nextIndex].focus();
                event.preventDefault(); // Prevent default arrow key behavior (e.g., scrolling)
            }
        }
        // Add keydown listeners to both tables
        table.addEventListener('keydown', handleKeydown);
        indiTable.addEventListener('keydown', handleKeydown);

        const divider = document.getElementById('divider');
        const leftPanel = document.getElementById('left-panel');
        const rightPanel = document.getElementById('right-panel');

        let isDragging = false;
        let startX;
        let startLeftWidth;

        divider.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startLeftWidth = leftPanel.offsetWidth;
            document.body.style.cursor = 'ew-resize';
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            const dx = e.clientX - startX;
            const newLeftWidth = startLeftWidth + dx;

            const containerWidth = document.body.offsetWidth;
            const minWidth = 100;

            if (newLeftWidth > minWidth && newLeftWidth < containerWidth - divider.offsetWidth - minWidth) {
                leftPanel.style.flex = 'none';
                leftPanel.style.width = newLeftWidth + 'px';
                rightPanel.style.flex = '1';
            }
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
            }
        });

        // Save functionality
        document.getElementById('saveBtn').addEventListener('click', saveTable);

        function saveTable() {
            const tableHTML = document.getElementById('masterTable').outerHTML;
            const htmlContent = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Master Time Table</title></head><body>${tableHTML}</body></html>`;
            const blob = new Blob([htmlContent], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'master-table.html';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Load functionality
        document.getElementById('loadBtn').addEventListener('click', loadTable);

        function loadTable() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.html';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const htmlString = event.target.result;
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(htmlString, 'text/html');
                        const newTable = doc.getElementById('masterTable');
                        if (newTable) {
                            const masterTable = document.getElementById('masterTable');
                            masterTable.innerHTML = newTable.innerHTML;
                            // Update the global allEditableCells array
                            allEditableCells = Array.from(document.querySelectorAll('.editable-cell'));
                            // Re-attach input listeners to all cells
                            allEditableCells.forEach(cell => {
                                cell.addEventListener('input', () => {
                                    cell.value = cell.value.toUpperCase();
                                    cell.setAttribute('value', cell.value);
                                });
                            });
                            // Re-add focus listeners to master table cells
                            const masterCells = Array.from(document.querySelectorAll('#masterTable .editable-cell'));
                            masterCells.forEach(cell => {
                                cell.addEventListener('focus', () => {
                                    const row = cell.closest('tr');
                                    const cellIndex = Array.from(row.children).indexOf(cell.closest('td'));
                                    if (cellIndex === 0) {
                                        // Time column, display content as is
                                        editBox.value = cell.value;
                                    } else if (cellIndex >= 1 && cellIndex <= 6) {
                                        // Mon-Sat columns, check format SUB(TR)
                                        const regex = /^[A-Z]{3}\([A-Z]{2}\)$/;
                                        if (regex.test(cell.value)) {
                                            const match = cell.value.match(/^\w+\(([^)]+)\)$/);
                                            if (match) {
                                                editBox.value = match[1];
                                            }
                                        }
                                        // If not in format, do nothing (leave editBox unchanged)
                                    }
                                });
                            });
                            // Re-add keydown listeners
                            masterTable.addEventListener('keydown', handleKeydown);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
    </script>
</body>
</html>
